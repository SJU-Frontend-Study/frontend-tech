# Javascript ë¹„ë™ê¸° ì²˜ë¦¬

# ëª©ì°¨

ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ë¹„ë™ê¸°ë¥¼ ê¹Šê²Œ ì•Œì•„ê°€ë³´ì

1. ì„ ì • ì´ìœ 
2. ìë°”ìŠ¤í¬ë¦½íŠ¸ (ëŸ°íƒ€ì„) êµ¬ì¡°
    1. Task Queue
    2. Microtask Queue
3. Event Loop ë™ì‘ ê³¼ì •
4. í€´ì¦ˆ1
5. í€´ì¦ˆ2
6. í€´ì¦ˆ3
7. ë²ˆì™¸
8. ì¶œì²˜

# ì„ ì •ì´ìœ 

### ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ë¹„ë™ê¸° ì²˜ë¦¬ì— ëŒ€í•´ì„œ ì•Œë ¤ì£¼ì„¸ìš”

microtask queue ê°€ ë¨¼ì € ì‹¤í–‰ì´ ë˜ê³ , macrotask queue ê°€ ë‚˜ì¤‘ì— ì²˜ë¦¬ë©ë‹ˆë‹¤.

microtask queue ì—ëŠ” promiseì˜ callback í•¨ìˆ˜ê°€ ë“¤ì–´ê°€ê³ , â€¦

macrotask queue ëŠ” í•˜ë‚˜ê°€ ì•„ë‹™ë‹ˆë‹¤

`setTimeout(()â‡’{}, 0);` ì´ê±´ ì–¸ì œ ì‹¤í–‰ë˜ì£ ?

macrotask queue ê°€ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì— ì—†ë‹¤ê³ ìš”?

<aside>
ğŸ”‘

ì´ ì§ˆë¬¸ì„ ì´ë²ˆì— í•´ê²°í•´ë³´ì!!

</aside>

# ìë°”ìŠ¤í¬ë¦½íŠ¸ (ëŸ°íƒ€ì„) êµ¬ì¡°

![image.png](0923-0.png)

- **í˜¸ìŠ¤íŠ¸, (ìë°”ìŠ¤í¬ë¦½íŠ¸) ëŸ°íƒ€ì„**: ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ í™˜ê²½ì„ êµ¬ì„±, ì‹¤í–‰. â†’ ë¸Œë¼ìš°ì €, Node.js
    - **JS Engine**: ìë°”ìŠ¤í¬ë¦½íŠ¸ ì–¸ì–´ í•´ì„ê¸° (js â†’ bytecode). V8, Webkitâ€¦
        - Heap
        - Call stack
    - **EventLoop**: Taskë¥¼ ì¡°ì •í•˜ê¸° ìœ„í•´ ì‚¬ìš©(ìŠ¤ì¼€ì¤„ë§), agent ë§ˆë‹¤ 1ê°œ
        - **TaskQueue:** ì‹¤í–‰ ê°€ëŠ¥í•œ Taskë¥¼ ì €ì¥í•˜ëŠ” Set. 1ê°œ ì´ìƒì„. (ê°ê°ì˜ í”„ë¡œì„¸ìŠ¤ë¥¼ ë” ë¹ ë¥´ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ.)
            - **Task:** ì´ë²¤íŠ¸, Web API ë“±ë“±
        - **MicrotaskQueue:** JobQueue ë¼ê³ ë„ ë¶€ë¦„ (ECMA Script) - ë…¼ë¦¬ì 
            - Microtask: ë¹ ë¥´ê²Œ ì²˜ë¦¬í•´ì•¼ í•  task : Promise, MutationObserver â€¦
            - task ê°€ ëë‚  ë•Œ ë§ˆë‹¤, Microtask Queue ëª¨ë‘ ì‹¤í–‰.
    - Web API : ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ í•  ìˆ˜ ìˆëŠ” API, ì‹¤í–‰ì€ ë¸Œë¼ìš°ì € ì—”ì§„ì— ìœ„ì„.
        - ë³‘ë ¬ ì²˜ë¦¬ ê°€ëŠ¥í•˜ë‹¤.
        - Task ë¡œ ë¶„ë¥˜ ë¨.
    
    ## TaskQueue (Macrotask Queue)
    
    - task ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ í
    - EventLoop ë§ˆë‹¤ 1ê°œ ì´ìƒì˜ í
    - Set (FIFO ì•„ë‹˜) : ì‹¤í–‰ ê°€ëŠ¥í•œ Task ë¥¼ ë°˜í™˜í•´ì•¼í•˜ê¸° ë•Œë¬¸ì—
    
    ### Task
    
    ì´ë²¤íŠ¸, íŒŒì‹±, ì½œë°±í˜¸ì¶œ, ë¦¬ì†ŒìŠ¤ì‚¬ìš©, Dom ì¡°ì‘ ë°˜ì‘í•˜ê¸° ìœ„í•œ Task 
    
    ## Microtask Queue (Job Queue)
    
    - Promise, MutationObserver ë“± ì„ ìœ„í•œ í
    - ì½œìŠ¤íƒì´ ë¹„ì›Œì§€ê±°ë‚˜, í•˜ë‚˜ì˜ Task ê°€ ì¢…ë£Œë˜ë©´ ëª¨ë‘ ì‹¤í–‰
    - `queueMicrotask` ë©”ì„œë“œë¡œ  ì½œë°± ë“±ë¡ ê°€ëŠ¥
    - V8 ì—”ì§„ ë‚´ë¶€ì— êµ¬í˜„, ê´€ë ¨ ë©”ì„œë“œ ì œê³µ.
        - `performMicrotaskCheckpoint` : microtask queue ë¥¼ ë¹„ìš°ê³ , ëª¨ë‘ ì‹¤í–‰
    - but, ì´ë²¤íŠ¸ë£¨í”„ì— ì˜í•´ì„œ ìŠ¤ì¼€ì¤„ë§ ë¨
    
    # Event Loop ë™ì‘ ê³¼ì •
    
    1. ì½œìŠ¤íƒì— ìŠ¤í¬ë¦½íŠ¸ê°€ ì˜¬ë¼ê°€ì„œ ë™ê¸° ì½”ë“œ ì‹¤í–‰
    2. ë™ê¸° ì½”ë“œê°€ ë¹„ë™ê¸° API í˜¸ì¶œí•˜ë©´ Web APIê°€ ì²˜ë¦¬í•˜ê³  ì½œë°±ì„ ì ì ˆí•œ íì— ë„£ìŒ
    3. ì½œìŠ¤íƒì´ ë¹„ì›Œì§€ë©´ **ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ í**ë¥¼ ëª¨ë‘ ë¹„ì›€(ëª¨ë“  ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ ì‹¤í–‰)
    4. ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ê°€ ëë‚˜ë©´ ë Œë”ë§(ë¸Œë¼ìš°ì €ê°€ í•„ìš”í•œ ê²½ìš°)
    5. ë Œë”ë§ ì´í›„ ë§¤í¬ë¡œíƒœìŠ¤í¬ íì—ì„œ ë‹¤ìŒ ì‘ì—…ì„ í•˜ë‚˜ êº¼ë‚´ ì‹¤í–‰
    6. ë°˜ë³µ
    
    # í€´ì¦ˆ1: ì‹¤í–‰ìˆœì„œ
    
    ```jsx
    Promise.resolve().then(() => console.log("1"));
    console.log("2");
    
    setTimeout(() => {
    	Promise.resolve().then(() => console.log("3"));
    	console.log("4");
    }, 0);
    
    console.log("5");
    
    Promise.resolve().then(() => {
    	setTimeout(() => console.log("6"), 0);
    	console.log("7");
    }, 0);
    
    console.log("8");
    ```
    
    - ì œ ìƒê°
        
        2 â†’ 5â†’ 8 â†’ 1 â†’ 7 â†’ 4 â†’ 3 â†’ 6
        
        ìš°ì„  ì½œìŠ¤íƒì„ ì „ë¶€ ë¹„ìš°ê³ 
        
        ë‹¤ìŒ ë§¤í¬ë¡œ íƒœìŠ¤í¬ [ (4)  ë§ˆì´í¬ë¡œ íƒœìŠ¤í¬ (3)  ] 
        
        Promise íì— ìŒ“ì€ê±° ìš°ì„ ìˆœìœ„   [1 â†’ 7 (ë§ˆì´í¬ë¡œ) ]
        
        ê·¸ëŸ¬ë‹¤ê°€ setTimeOutë§Œë‚˜ì„œ ë§¤í¬ë¡œ íƒœìŠ¤í¬ì— ì €ì¥, (6)
        
    
    ### ë³´ê¸°
    
    ```bash
    1
    2
    3
    4
    5
    6
    7
    8
    ```
    
    ```bash
    2
    5
    8
    1
    4
    7
    3
    6
    ```
    
    ```bash
    2
    5
    8
    1
    7
    4
    3
    6
    ```
    
    ## í€´ì¦ˆ1 í’€ì´
    
    1. Microtask Queue â† console.log(1);
    2. ì¶œë ¥ `2`
    3. Task Queue â† setTimeout Callback
    4. ì¶œë ¥ `5`
    5. Microtask Queue â† promise resolve callback
    6. ì¶œë ¥ `8`
    7. MicrotaskQueue ì‘ì—…ì„ ëª¨ë‘ ì²˜ë¦¬
        1. ì¶œë ¥ `1`  > 1ë²ˆì— ë“¤ì–´ê°„ microtask
        2. promise resolve callback ì‹¤í–‰ (5ë²ˆ)
            1. Task Queue â† setTimeout Callback
            2. ì¶œë ¥ `7` 
    8. Task Queue - setTimeout ì‘ì—… ì™„ë£Œ (3)
        1. Microtask Queue â† promise resolve callback
        2. ì¶œë ¥ `4`
    9. Microtask Queue ì‘ì—… ëª¨ë‘ ì²˜ë¦¬
        1. promise resolve callback ì‹¤í–‰ (8-a)
            1. `3`
    10. Task Queue - setTimeout ì‘ì—… ì™„ë£Œ (7-b-i)
        1. ì¶œë ¥ `6`
    

# í€´ì¦ˆ 2: Render ë¸”ë¡œí‚¹

```jsx
const SIZE = 5000000000
for (let i = 0; i < SIZE; i++)
	if (i % 10000 === 0)
		document.body.innerText = i+'';
document.body.innerText = '';
```

## í•´ê²° ë°©ë²•

ì½œìŠ¤íƒì´ ë¹„ì–´ìˆì§€ ì•Šê¸°(ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ê³  ìˆê¸°) ë•Œë¬¸ì—, ë Œë”ë§ì´ ë¸”ë¡œí‚¹ ë©ë‹ˆë‹¤.

```jsx
const SIZE = 5000000000

let i = 0;
function count() {
	for (; i < SIZE; i++) {
		if (i % 100000000 === 0) {
			document.body.innerText = i+'';
			
			if (i < SIZE) {
				setTimeout(count, 0);
				i++;
				break;
			}
		}
	}
	
	if (i >= SIZE)
		document.body.innerText = '';
}

count();
```

# í€´ì¦ˆ 3: ì´ë²¤íŠ¸

```jsx
$inner.addEventListener('click', () => {
	Promise.resolve().then(() => console.log("Promise 1"));
	console.log('click 1');
});

$inner.addEventListener('click', () => {
	Promise.resolve().then(() => console.log("Promise 2"));
	console.log('click 2');
});

$outer.addEventListener('click', () => {
	Promise.resolve().then(() => console.log("Promise 3"));
	console.log('click 3');
});
```

```jsx
$inner.dispatchEvent(new Event('click', { bubbles: true; }))
```

# ë²ˆì™¸: Web API ì˜ ë³‘ë ¬ ì²˜ë¦¬

```jsx
// ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì€ ë³‘ë ¬ì²˜ë¦¬ê°€ ê°€ëŠ¥í• ê¹Œ? => Yes
fetch("https://search.naver.com/search.naver?where=nexearch&sm=top_hty&fbm=0&ie=utf8&query=naver&ackey=3w8uikf6")
	.then((data) => data.text())
	.then(res => console.log(res));

const SIZE = 5000000000
for (let i = 0; i < SIZE; i++)
	if (i % 100000000 === 0)
		console.log(i);
```

- ê²°ê³¼
    
    ![image.png](0923-1.png)
    

# ì¶œì²˜

https://html.spec.whatwg.org/multipage/webappapis.html#event-loop

https://tc39.es/ecma262/#sec-agents

https://ko.javascript.info/event-loop

https://inpa.tistory.com/entry/%F0%9F%94%84-%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84-%EA%B5%AC%EC%A1%B0-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC

https://youtu.be/YpQTeIqjC4o

with. chat GPT